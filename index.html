<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุฃุจุทุงู ุงูุชุณุงูุญ: ุงุฎุชุจุงุฑ ูููุฉ ุงูุชุณุงูุญ</title>
    <style>
        /* Base CSS Variables for Dynamic Th... */
        :root {
            --primary-color: #00796b;      /* Teal/Dark Green (Main Heading, Core Text) */
            --secondary-color: #4db6ac;    /* Light Teal (Borders) */
            --background-light: #e3f2fd;   /* Light Blue (Text Section Background) */
            --highlight-color: #ff9800;    /* Warm Orange (Scoreboard) */
            --accent-color: #ffb74d;       /* Light Orange (Question Highlight) */
            --results-bg: #e0f7fa;         /* Light Cyan (Results Background) */
            --text-dark: #1565c0;          /* Dark Blue (Question Text) */
            --result-score-highlight: #CC0000; /* Dark Red (Final Score) */
            --score-label-color: #5D3A9B; /* Deep Violet/Purple for Labels */
            --score-value-color: #CC0000; /* Dark Red for Values */
        }

        /* Female/Pink Theme Variables (Will be set by JS) */
        .female-theme {
            --primary-color: #AD1457 !important;      /* Deep Pink */
            --secondary-color: #f48fb1 !important;    /* Light Pink (Borders) */
            --background-light: #fce4ec !important;   /* Very Light Pink (Text Section Background) */
            --highlight-color: #ff5722 !important;    /* Deep Orange (Scoreboard) */
            --accent-color: #f06292 !important;       /* Pink (Question Highlight) */
            --results-bg: #f8bbd0 !important;         /* Soft Pink (Results Background) */
            --text-dark: #880e4f !important;          /* Darker Pink (Question Text) */
        }

        /* Global Styles */
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap');
        
        body {
            font-family: 'Tajawal', sans-serif;
            background-color: #f7f7f7;
            color: #1a1a1a;
            margin: 0;
            padding: 24px 0;
            font-size: 28px; /* Base Font Size */
            text-align: right;
        }
        .container {
            max-width: 950px;
            margin: 0 auto;
            padding: 35px;
            border-radius: 18px;
            box-shadow: 0 10px 40px rgba(0, 50, 80, 0.1);
        }
        h1 {
            color: var(--primary-color);
            text-align: center;
            border-bottom: 4px solid var(--secondary-color);
            padding-bottom: 15px;
            margin-bottom: 30px;
            font-size: 1.6em; 
        }
        h2 {
            font-size: 1.3em;
            color: var(--primary-color);
            margin-bottom: 20px;
        }
        /* Text Section (Reading Material) */
        .text-section {
            position: relative;
            background-color: var(--background-light);
            border: 1px solid var(--secondary-color);
            padding: 20px;
            padding-top: 45px;
            margin-bottom: 35px;
            border-radius: 12px;
            max-height: 450px;
            overflow-y: auto;
            line-height: 1.9;
            font-size: 1em; /* Fixed size based on new body font */
            font-weight: bold; 
        }
        .text-section .read-instruction {
            color: #FF0000;
            font-size: 1.1em; /* Larger than surrounding text */
            display: block;
            text-align: center;
            margin-bottom: 15px;
        }
        .audio-icon {
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 1.5em;
            color: var(--primary-color);
            cursor: pointer;
            text-decoration: none;
            z-index: 10;
            transition: color 0.2s;
        }
        .audio-icon:hover {
            color: var(--highlight-color);
        }
        .score-board {
            display: flex;
            justify-content: space-around;
            align-items: center;
            font-size: 1.2em;
            font-weight: bold;
            color: var(--score-label-color);
            margin-bottom: 30px;
            padding: 18px;
            border: 2px solid var(--accent-color);
            border-radius: 12px;
            background-color: #fff3e0;
        }
        .score-board span {
            color: var(--score-value-color);
            margin-left: 5px;
        }
        /* Question Text and Elements */
        .question {
            margin-bottom: 30px;
            padding: 25px;
            background-color: #ffffff;
            border-radius: 12px;
            border-left: 6px solid var(--accent-color);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }
        .question p {
            font-weight: bold;
            margin-top: 0;
            font-size: 1.1em; /* Question text size */
            color: var(--text-dark);
        }
        /* Option Buttons - Large, clear, and BOLD */
        .option-btn {
            display: block;
            width: 100%;
            padding: 18px 25px; 
            margin: 10px 0;
            border: 2px solid var(--secondary-color);
            border-radius: 8px;
            background-color: var(--background-light);
            cursor: pointer;
            text-align: right;
            transition: all 0.3s ease;
            font-size: 1em; 
            font-weight: bold;
        }
        .correct {
            background-color: #4CAF50 !important;
            color: white;
            border-color: #388E3C !important;
        }
        .incorrect {
            background-color: #F44336 !important;
            color: white;
            border-color: #D32F2F !important;
        }
        /* Fill in the Blanks Inputs - Stage 3 */
        .fill-in input[type="text"] {
            padding: 15px;
            border: 2px solid #ccc;
            border-radius: 5px;
            width: 20%; 
            margin-left: 10px;
            font-size: 1em; 
            text-align: right;
        }
        /* Check Button Styling (Stage 3) */
        .check-btn {
            background-color: #A9A9A9; /* Gray */
            color: white;
            padding: 12px 25px; 
            border: 2px solid #808080;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em; 
            font-weight: bold;
            transition: background-color 0.3s;
            margin-right: 15px;
            box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.4), 0 1px 1px rgba(0, 0, 0, 0.2);
        }
        .check-btn:disabled {
            cursor: not-allowed;
            opacity: 0.6;
        }
        /* Stage Buttons - Large and clear */
        .stage-btn, #start-quiz-btn {
            background-color: var(--primary-color);
            color: white;
            padding: 18px 40px; 
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.1em; 
            font-weight: bold;
            transition: background-color 0.3s, transform 0.2s;
            display: block;
            width: fit-content;
            margin: 25px auto 0;
        }
        .results {
            text-align: center;
            margin-top: 30px;
            padding: 40px;
            background-color: var(--results-bg);
            border-radius: 15px;
            color: #263238;
            font-size: 1.15em;
            font-weight: bold;
        }
        /* Styling for the small warning text in Stage 3 */
        .stage-3-note {
            font-size: 0.8em; 
            display: block;
            margin-top: 10px;
            text-align: center;
        }
        .stage-3-note .red-text {
            color: #FF0000;
            background-color: #FFFFE0; 
            padding: 5px 10px;
            border-radius: 10px;
            border: 2px dashed var(--primary-color); 
            font-weight: 700;
            display: inline-block;
        }
        /* Achievement Message Style (Result Page) */
        #final-message {
            margin: 20px auto;
            padding: 15px;
            border: 3px dashed var(--primary-color); 
            border-radius: 10px;
            background-color: #E0FFFF; 
            font-size: 1.2em;
            color: var(--text-dark);
            max-width: 80%;
        }
        /* Final Score and Data Highlight */
        #final-score, #final-max-score {
             color: var(--result-score-highlight);
             font-size: 1.2em;
        }
        .student-data-highlight {
            color: var(--result-score-highlight);
            font-size: 1.1em; 
        }
        /* Start Screen Specific Styles */
        #start-screen {
            text-align: center;
            padding: 60px;
            background-color: var(--results-bg); 
            border-radius: 15px;
            border: 3px solid var(--secondary-color);
        }
        .input-group {
            margin-bottom: 25px;
            display: flex; 
            align-items: center;
            justify-content: flex-end;
            gap: 20px;
        }
        .input-group label {
            font-size: 1.2em; 
            color: var(--text-dark);
            text-align: right;
            flex-basis: 30%; 
            font-weight: bold;
        }
        .input-group input[type="text"] {
            padding: 15px;
            font-size: 1.1em; 
            border: 2px solid var(--secondary-color);
            background-color: #fff;
            margin-top: 0;
            width: 48%; 
            box-sizing: border-box;
            font-weight: bold;
        }
        /* Gender Selection Buttons Styling */
        .radio-group-container {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: 20px;
            margin-bottom: 30px;
        }
        .radio-group {
            display: flex;
            gap: 15px;
            flex-basis: 48%; 
            justify-content: space-between;
        }
        .radio-group input[type="radio"] {
            display: none;
        }
        .radio-group label {
            padding: 12px 20px;
            border: 2px solid var(--primary-color);
            border-radius: 8px;
            cursor: pointer;
            background-color: #fff;
            transition: all 0.3s;
            font-weight: 700;
            color: var(--primary-color);
            flex-grow: 1; 
            text-align: center;
            font-size: 1em;
            display: block;
        }
        .radio-group input[type="radio"]:checked + label {
            background-color: var(--primary-color);
            color: white;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
        }

        /* Footer Style (Adjusted for requested changes) */
        .footer {
            text-align: center;
            margin-top: 30px;
            font-size: 1em; /* Increased from 0.8em */
            color: #000000; /* Changed to black */
            font-weight: bold; /* Added bold */
        }
    </style>
</head>
<body id="game-body">

<div class="container">
    <h1>๐ ุฃุจุทุงู ุงูุชุณุงูุญ: ุงุฎุชุจุงุฑ ูููุฉ ุงูุชุณุงูุญ ๐๏ธ</h1>

    <div id="start-screen" class="stage" style="display: block;">
        <h2>ุฃููุงู ุจู ูู ุงุฎุชุจุงุฑ ุฃุจุทุงู ุงูุชุณุงูุญ!</h2>
        <p style="font-size: 1.1em; color: #546e7a; margin-bottom: 35px;">ุงูุฑุฌุงุก ุฅุฏุฎุงู ุจูุงูุงุชู ูููุชุงุจุนุฉ:</p>
        
        <div class="input-group">
            <label for="student-name">ุงูุงุณู ุงูุซูุงุซู:</label>
            <input type="text" id="student-name" placeholder="ุฃุฏุฎู ุงุณูู ุงูุซูุงุซู ููุง" required>
        </div>
        
        <div class="input-group">
            <label for="student-class">ุงูุตู ูุงููุตู:</label>
            <input type="text" id="student-class" placeholder="ูุซุงู: ุงูุตู ุงูุฎุงูุณ ุฃ" required>
        </div>
        
        <div class="radio-group-container">
            <div class="radio-group">
                <input type="radio" name="gender" id="gender-female" value="ุทุงูุจุฉ" required><label for="gender-female">ุทุงูุจุฉ</label>
                <input type="radio" name="gender" value="ุทุงูุจ" id="gender-male" required><label for="gender-male">ุทุงูุจ</label>
            </div>
        </div>
        
        <button id="start-quiz-btn" onclick="checkInputsAndGoToIntro()">ุงุจุฏุฃ ุงูุงุฎุชุจุงุฑ โจ</button>
    </div>

    <div id="intro-page-content" class="stage" style="display: none;">
        
        <button class="stage-btn" id="start-quiz-main-btn" onclick="startQuiz()" style="width: 100%; margin-bottom: 20px;">ุงููุฑ ููุง ูุชุจุฏุฃ ูููุฉ ุงูุชุณุงูุญ!</button>

        <div class="text-section" id="intro-text-section-content">
            <span class="read-instruction">ุงูุฑุฃ ุงููุต ุฌูุฏุงู ูุจู ุงูุจุฏุก ูู ุญู ุงูุฃุณุฆูุฉ.</span>
            <p><b>ุงูุชุณุงูุญ:</b> ุฎูู ุดุงูู ููุถูู ุชุญุชู ุนุฏุฉ ุฃุฎูุงู ุฃุฎุฑู ุ ููู ุฃูููุง: ุงูุฑุญูุฉุ ูุงูุฑุฃูุฉ ูุงูุนุทูุ ูุฎูู ุงูุณูุงู ุงูุฐู ูุนุฏ ุงูุดุนุงุฑ ุงูุฃูู ููุฅุณูุงู ูุงููุณูููู ุ ูุงูุนุฏู ูุงูุฅุญุณุงู ุ ูุงูุนูู ูุงูุตูุญ ุนู ุงููุณูุฆูู ุ ูุจุฎุงุตุฉ ุนูุฏ ุงููุฏุฑุฉ ุนูู ุงูุฑุฏ ุ ูุงูุงุนุชุฏุงู ูุนุฏู ุงูุชุดุฏุฏ ุ ููุจุฐ ุงูุชุนุตุจ ูู ุตูุฑู ุงูุฌุงูููุฉ ูููุง .</p>
            <p>ููุฏ ุฑุจุท ุงููุจู ุนููู ุงูุตูุงุฉ ูุงูุณูุงู ุจูู ุงูุณูุงุญุฉ ูุจูู ุฃุตู ุงูุฏูู ุงูุฅุณูุงููุ ุฅุฐ ุฌุนููุง ูู ุงูุนุฏูุฏ ูู ุฃุญุงุฏูุซู ูุตูุง ููุงุฒูุงุ ููุง ูู ูููู: ยซุจุนุซุช ุจุงูุญููููุฉ ุงูุณูุญุฉยปุ ูุฑุณุงูุฉ ุงููุจู ุนููู ุงูุตูุงุฉ ูุงูุณูุงู ุฑุณุงูุฉ ุญููููุฉ ุฃู : ูุงุฆูุฉ ุนู ุงูุจุงุทู ุฅูู ุงูุญู ุ ูุฑุณุงูุฉ ุณูุญุฉ ุฃู : ุณููุฉ ูุณูุฑุฉ; ููู ุญูุงุชู ูุชุดุฑูุนุงุชู ูุฅุฑุดุงุฏุงุชู ูุงุฆูุฉ ุนูู ุงููุณุฑ ูุงูุณูุงุญุฉ ูุงูุชุฎููู ุนูู ุฃูุชู .</p>
            <p>ูุงู ุงููู ุชุนุงูู: ๏ดฟ ููุจูููุง ุฑูุญูููุฉู ูููู ุงูููููู ููููุชู ูููููู ูููููู ููููุชู ููุธููุง ุบููููุธู ุงููููููุจู ููุงููููุถูููุง ูููู ุญููููููู ููุงุนููู ุนููููููู ููุงุณูุชูุบูููุฑู ูููููู ููุดูุงููุฑููููู ููู ุงููุฃูููุฑู ููุฅูุฐูุง ุนูุฒูููุชู ููุชูููููููู ุนูููู ุงูููููู ุฅูููู ุงูููููู ููุญูุจูู ุงููููุชููููููููููู ๏ดพ</p>
            <p>ููุงู ุชุนุงูู : ๏ดฟ ุงูููุฐูููู ููููููููููู ููู ุงูุณููุฑููุงุกู ููุงูุถููุฑููุงุกู ููุงููููุงุธูููููู ุงููุบูููุธู ููุงููุนูุงููููู ุนููู ุงููููุงุณู ููุงูููููู ููุญูุจูู ุงููููุญูุณูููููู ๏ดพ.</p>
            <p>ูุงูุชุณุงูุญ ูุทููุจ ูู ุฌููุน ุงููุนุงููุงุช ุงูุนุงูุฉ ุจูู ุงููุงุณ ุ ููู ุงูุชุนุงูู ุงูุงุฌุชูุงุนู ูุน ุงููุณูููู ุ ุจุงูุนูู ุนูู ุฃุณุงุก ุ ูุตูุฉ ูู ูุทุน ุ ูุฅุนุทุงุก ูู ููุน .</p>
            <p>ุงูุชุณุงูุญ ุฎูู ุงูุฑุณู ูุงูุฃูุจูุงุก ุนูููู ุงูุตูุงุฉ ูุงูุณูุงู ุ ูุงููุตูุญูู ูู ุงูุฃูู ุนูู ูุฑ ุงูุชุงุฑูุฎ ุ ูุฃู ุงูุชุณุงูุญ ุจูุงุจุฉ ูุชุญููู ูุง ุฃุฑุณููุง ุจู ููุง ูุฏุนูู ุฅููู ุ ูุงููุจู ุนููู ุงูุตูุงุฉ ูุงูุณูุงู ูู ุฃูุจู ุงูุจุดุฑ ูุฃูุถููู ุฃุฎูุงูุง ุ ููู ููู ูุชุญ ููุฉ ูุงู ูุฃูู ููุฉ ุงูุฐูู ุขุฐูู ูุญุงุฑุจูู ูุฃุฎุฑุฌูู ูู ุฏุงุฑู : ( ุงุฐูุจูุง ูุฃูุชู ุงูุทููุงุก ) .</p>
            <p>ูุง ูู ุฃูุณ ุจู ูุงูู - ุฑุถู ุงููู ุนูู ุฎุงุฏู ุฑุณูู ุงููู ูุฎุจุฑูุง ุนู ุฎูู ุงููุจู ุนููู ุงูุตูุงุฉ ูุงูุณูุงู ูุณูุงุญุชู ูุน ูู ูุฎุฏูู ุ ูููุถู ุญูุงุฆุฌู ุ ููููู: ( ุฎุฏูุช ุงูุฑุณูู ุนุดุฑ ุณููู ุ ูุงููู ูุง ูุงู ูู : ุฃููู ูุท ุ ููุง ูุงู ูู ูุดูุก : ูู ูุนูุช ูุฐุง ุ ูููููุง ูุนูุช ูุฐุง ) ุฑูุงู ูุณูู.</p>
        </div>
    </div>
    
    <div class="score-board" id="score-board-main" style="display: none;">
        <div style="color: var(--score-label-color);">ุงูููุงุท ุงูุญุงููุฉ: <span id="current-score" style="color: var(--score-value-color);">0</span> ๐</div>
        <div style="color: var(--score-label-color);">ุงูุฏุฑุฌุฉ ุงูููุงุฆูุฉ: <span id="max-score-display" style="color: var(--score-value-color);">25</span> ููุทุฉ.</div>
    </div>

    <div class="quiz-section" style="display: none;">

        <div id="stage-1" class="stage">
            </div>

        <div id="stage-2" class="stage">
            </div>

        <div id="stage-3" class="stage">
            </div>

        <div id="results" class="results stage">
            <h2>๐ ูุจุฑูู! ููุงูุฉ ูููุฉ ุจุทู ุงูุชุณุงูุญ ๐</h2>
            
            <p style="font-size: 1.5em; margin-bottom: 25px;">ููุฏ ุญุตูุช ุนูู ูุฌููุน ููุงุท ูุฏุฑู: <strong id="final-score" style="color:var(--result-score-highlight);">0</strong> ููุทุฉ ูู <span id="final-max-score">25</span>.</p>
            
            <div class="achievement-message" id="final-message"></div>

            <p style="font-size: 1.1em; color: #5d4037; margin-top: 30px;">
                <span id="type-display"></span>: <br> 
                ุงูุงุณู: <span id="display-name" class="student-data-highlight"></span> <br> 
                ุงูุตู/ุงููุตู: <span id="display-class" class="student-data-highlight"></span> 
            </p>
            
            <button class="stage-btn" id="print-btn" onclick="printCertificate()">ุทุจุงุนุฉ ุดูุงุฏุฉ ุงูุชุณุงูุญ ๐จ๏ธ</button>
            <button class="stage-btn" onclick="location.reload()" style="background-color: var(--primary-color);">ุงูุนุจ ูุฌุฏุฏุงู ๐</button>
        </div>
    </div>

</div>

<div class="footer" style="color: #5D3A9B;">
	 ุชุตููู ุงููุนููุฉ : ููุงุก ุงูุบุงูุฏู
</div>
<div class="footer" style="color: #5D3A9B;">
	 ูุงุฆุฏุฉ ุงููุฏุฑุณุฉ: ููุงูุฉ ุงูููุงูู 
</div>

<script>
    let score = 0;
    const maxScore = 25; 
    const pointValue = 1;

    let studentName = "";
    let studentClass = "";
    let studentGender = "";

    // Function to dynamically apply the selected theme
    function applyTheme(gender) {
        const root = document.documentElement;
        if (gender === 'ุทุงูุจุฉ') {
            root.style.setProperty('--primary-color', '#AD1457');      
            root.style.setProperty('--secondary-color', '#f48fb1');    
            root.style.setProperty('--background-light', '#fce4ec');   
            root.style.setProperty('--highlight-color', '#ff5722');    
            root.style.setProperty('--accent-color', '#f06292');       
            root.style.setProperty('--results-bg', '#f8bbd0');         
            root.style.setProperty('--text-dark', '#880e4f');          
            root.style.setProperty('--result-score-highlight', '#CC0000');
            document.getElementById('game-body').classList.add('female-theme');
        } else {
            // Default Male/Teal Theme
            root.style.setProperty('--primary-color', '#00796b');
            root.style.setProperty('--secondary-color', '#4db6ac');
            root.style.setProperty('--background-light', '#e3f2fd');
            root.style.setProperty('--highlight-color', '#ff9800');
            root.style.setProperty('--accent-color', '#ffb74d');
            root.style.setProperty('--results-bg', '#e0f7fa');
            root.style.setProperty('--text-dark', '#1565c0');
            root.style.setProperty('--result-score-highlight', '#CC0000');
            document.getElementById('game-body').classList.remove('female-theme');
        }
    }

    // --- Data: Questions and Answers (Retained from previous version) ---
    const questions = {
        // --- True/False Questions (Stage 1) - 10 Q (1 pt each = 10) ---
        tf: [
            { id: 'tf1', q: "ุงูุชุณุงูุญ ุฎูู ุดุงูู ููุถูู ุชุญุชู ุฃุฎูุงู ูุซู ุงูุฑุญูุฉ ูุงูุณูุงู.", a: true, points: pointValue, answered: false, feedback_c: "ุตุญูุญ! ุงูุชุณุงูุญ ูู ุฎูู ุนุธูู ูุฌูุน ุจูู ุงูุฑุญูุฉ ูุงูุฑุฃูุฉ ูุงูุนุทู ูุงูุณูุงู.", feedback_i: "ุฎุทุฃ. ุงูุชุณุงูุญ ููุณ ุฎููุงู ุจุณูุทุงูุ ุจู ูู ุฎูู ุดุงูู ูุถู ุงูุฑุญูุฉ ูุงูุฑุฃูุฉ ูุงูุณูุงู ููุง ูุฑุฏ ูู ุงููุต." },
            { id: 'tf2', q: "ุงูุนูู ูุงูุตูุญ ุนู ุงููุณูุฆูู ูุทููุจ ููุท ุนูุฏ ุนุฏู ุงููุฏุฑุฉ ุนูู ุงูุฑุฏ.", a: false, points: pointValue, answered: false, feedback_c: "ุตุญูุญ! ุงูุนูู ูุทููุจ ุญุชู ูุน ุงููุฏุฑุฉ ุนูู ุงูุฑุฏุ ููุฐุง ูู ููุฉ ุงูููุฉ.", feedback_i: "ุฎุทุฃ. ุงูุนูู ูุงูุตูุญ ูุทููุจุงู ุจุฎุงุตุฉ ุนูุฏ **ุงููุฏุฑุฉ ุนูู ุงูุฑุฏ**ุ ููุฐุง ุฏููู ููุฉ ูุง ุถุนู." },
            { id: 'tf3', q: "ุฑุณุงูุฉ ุงููุจู ุตูู ุงููู ุนููู ูุณูู ูุงูุช ุณูุญุฉ ุฃู ุณููุฉ ูุณูุฑุฉ.", a: true, points: pointValue, answered: false, feedback_c: "ุตุญูุญ! ูุฐุง ูู ูุนูู 'ุฑุณุงูุฉ ุณูุญุฉ' ุฃู ูุงุฆูุฉ ุนูู ุงููุณุฑ ูุงูุชุฎููู ุนูู ุงูุฃูุฉ.", feedback_i: "ุฎุทุฃ. ุฑุณุงูุฉ ุงููุจู (๏ทบ) ูุณูุญุชูุง ุชุนูู ุฃููุง ุณููุฉ ูุณูุฑุฉุ ูููุณุช ุตุนุจุฉ ููุชุดุฏุฏุฉ." },
            { id: 'tf4', q: "ูููู ุชุนุงูู: ๏ดฟูููููู ููููุชู ููุธููุง ุบููููุธู ุงููููููุจู ููุงููููุถูููุง ูููู ุญููููููู๏ดพ ูุฏู ุนูู ุฃูููุฉ ุงููุณูุฉ.", a: false, points: pointValue, answered: false, feedback_c: "ุตุญูุญ! ุงูุขูุฉ ุชุฏู ุนูู ุฃูููุฉ ุงูููู ูุงูุฑุญูุฉ (ุงูุชุณุงูุญ) ูุชุฌูุจ ุงููุธุงุธุฉ.", feedback_i: "ุฎุทุฃ. ุงูุขูุฉ ุชุฏู ุนูู ุฃู ุงููุธุงุธุฉ ูุบูุธุฉ ุงูููุจ ุชุคุฏู ุฅูู ุชูุฑู ุงููุงุณ ูุงุจุชุนุงุฏููุ ูุฐุง ูุฌุจ ุงูุชุญูู ุจุงูุชุณุงูุญ ูุงูููู." },
            { id: 'tf5', q: "ุงูุชุณุงูุญ ูุทููุจ ูู ุฌููุน ุงููุนุงููุงุช ุงูุนุงูุฉ ูุงูุงุฌุชูุงุนูุฉ ุจูู ุงููุงุณ.", a: true, points: pointValue, answered: false, feedback_c: "ุตุญูุญ! ุงูุชุณุงูุญ ูุดูู ุงูุนูู ุนูู ุฃุณุงุกุ ูุตูุฉ ูู ูุทุนุ ูุฅุนุทุงุก ูู ููุน ูู ูู ุงููุนุงููุงุช.", feedback_i: "ุฎุทุฃ. ุงูุชุณุงูุญ ูุทููุจ ูู ุฌููุน ุงููุนุงููุงุช ุงูุนุงูุฉ ูุงูุงุฌุชูุงุนูุฉ ุฏูู ุงุณุชุซูุงุก." },
            { id: 'tf6', q: "ูู ููู ูุชุญ ููุฉุ ุนุงูุจ ุงููุจู (๏ทบ) ุฃูู ููุฉ ุงูุฐูู ุขุฐูู ุนูุงุจุงู ุดุฏูุฏุงู.", a: false, points: pointValue, answered: false, feedback_c: "ุตุญูุญ! ุงููุจู (๏ทบ) ูู ูุนุงูุจูู ุจู ูุงู ููู: 'ุงุฐูุจูุง ูุฃูุชู ุงูุทููุงุก'ุ ููุฐุง ุฃุนุธู ูุซุงู ููุชุณุงูุญ.", feedback_i: "ุฎุทุฃ. ุงูุชุณุงูุญ ุงููุจูู ุธูุฑ ูู ุฃุจูู ุตูุฑู ุจูููู: 'ุงุฐูุจูุง ูุฃูุชู ุงูุทููุงุก' ุฑุบู ุฃุฐุงูู." },
            { id: 'tf7', q: "ุฃูุณ ุจู ูุงูู ุฎุฏู ุงูุฑุณูู (๏ทบ) ุฎูุณ ุณููุงุช ููุท.", a: false, points: pointValue, answered: false, feedback_c: "ุตุญูุญ! ุฎุฏู ุฃูุณ ุจู ูุงูู ุงูุฑุณูู (๏ทบ) ุนุดุฑ ุณูููุ ููุฐุง ูุง ุฃูุฏู ุงูุญุฏูุซ ุงููุงุฑุฏ ูู ุงููุต.", feedback_i: "ุฎุทุฃ. ุฎุฏู ุฃูุณ ุจู ูุงูู ุฑุณูู ุงููู (๏ทบ) ุนุดุฑ ุณูููุ ููู ููู ูู 'ุฃูู' ูุท." },
            { id: 'tf8', q: "ุงูุชุดุฏุฏ ู ุงูุชุนุตุจ ูู ุงูุฃุฎูุงู ุงูุชู ููุถูู ุชุญุชูุง ุงูุชุณุงูุญ.", a: false, points: pointValue, answered: false, feedback_c: "ุตุญูุญ! ุงูุชุดุฏุฏ ูุงูุชุนุตุจ ููุณุง ูู ุงูุชุณุงูุญุ ุจู ูุฌุจ ูุจุฐููุง.", feedback_i: "ุฎุทุฃ. ุงูุชุดุฏุฏ ูุงูุชุนุตุจ ููุง ูููุถ ุงูุชุณุงูุญุ ูุฐุง ูุฌุจ ูุจุฐููุง." },
            { id: 'tf9', q: "ุงูุขูุฉ ๏ดฟููุงููุนูุงููููู ุนููู ุงููููุงุณู๏ดพ ุชุฑุจุท ุงูุนูู ุจูุญุจุฉ ุงููู ูููุญุณููู.", a: true, points: pointValue, answered: false, feedback_c: "ุตุญูุญ! ุงูุขูุฉ ุชูุฎุชู ุจูููู ุชุนุงูู: ๏ดฟููุงูููููู ููุญูุจูู ุงููููุญูุณูููููู๏ดพุ ููุง ูุฑุจุท ุงูุนูู ุจุงูุฅุญุณุงู.", feedback_i: "ุฎุทุฃ. ุงูุขูุฉ ุชุฑุจุท ุงูุนูู ุจุงูุฅุญุณุงูุ ููุง ูุฏู ุนูู ูุญุจุฉ ุงููู ููู ูุนูู ุนู ุงููุงุณ." },
            { id: 'tf10', q: "ุงูุชุณุงูุญ ููุณ ูู ุฃุฎูุงู ุงูุฑุณู ูุงูุฃูุจูุงุกุ ุจู ูู ุฎุงุต ุจุงููุตูุญูู ููุท.", a: false, points: pointValue, answered: false, feedback_c: "ุตุญูุญ! ุงูุชุณุงูุญ ูู ุฎูู ุงูุฑุณู ูุงูุฃูุจูุงุก ูุงููุตูุญูู ุนูู ูุฑ ุงูุชุงุฑูุฎ.", feedback_i: "ุฎุทุฃ. ุงูุชุณุงูุญ ุฎูู ุงูุฑุณู ูุงูุฃูุจูุงุก ูุฃูู ุจูุงุจุฉ ูุชุญููู ูุง ุฃุฑุณููุง ุจู ููุง ูุฏุนูู ุฅููู." }
        ],
        
        // --- Multiple Choice Questions (Stage 2) - 10 Q (1 pt each = 10) ---
        mc: [
            { id: 'mc1', q: "ุฎูู ุงูุชุณุงูุญ ููุถูู ุชุญุชู ูุจุฐ:", options: ["ุงูุฑุญูุฉ", "ุงูุนุฏู", "ุงูุชุนุตุจ ูู ุตูุฑู ุงูุฌุงูููุฉ", "ุงูุนูู ูุงูุตูุญ"], a: 2, points: pointValue, answered: false, feedback_c: "ุฅุฌุงุจุฉ ุตุญูุญุฉ! ุงูุชุณุงูุญ ูุญุงุฑุจ ุงูุชุนุตุจ ูุงูุชุดุฏุฏ ูุฃูููุง ุถุฏุงู ูู.", feedback_i: "ุฅุฌุงุจุฉ ุฎุงุทุฆุฉ. ุงูุชุณุงูุญ ูู ูููุถ ุงูุชุนุตุจุ ูุฐุง ูุฌุจ ูุจุฐ ุงูุชุนุตุจ ุงูุฌุงููู." },
            { id: 'mc2', q: "ูุง ูุนูู ุฑุณุงูุฉ ุงููุจู (๏ทบ) 'ุญููููุฉ'ุ", options: ["ูุงุฆูุฉ ุนูู ุงูุดุฏุฉ", "ูุงุฆูุฉ ุนู ุงูุจุงุทู ุฅูู ุงูุญู", "ูุฏููุฉ ุฌุฏุงู", "ุตุนุจุฉ ููุฌูุฏุฉ"], a: 1, points: pointValue, answered: false, feedback_c: "ุฅุฌุงุจุฉ ุตุญูุญุฉ. ุงูุญููููุฉ ุชุนูู ุงูููู ุนู ุงูุจุงุทู ุฅูู ุงูุญูุ ูุงูุณูุงุญุฉ ุชุนูู ุงููุณุฑ.", feedback_i: "ุฅุฌุงุจุฉ ุฎุงุทุฆุฉ. ุฑุณุงูุฉ ุงููุจู (๏ทบ) 'ุญููููุฉ' ุชุนูู ุฃููุง ูุงุฆูุฉ ุนู ุงูุจุงุทู ุฅูู ุงูุญู." },
            { id: 'mc3', q: "ุงูุชุณุงูุญ ููุซู ุจูุงุจุฉ ูุชุญููู ูุง ุฃูุฑุณู ุจู:", options: ["ุงููุนูููู ููุท", "ุงูุฑุณู ูุงูุฃูุจูุงุก", "ุงููุงุฏุฉ ุงูุนุณูุฑููู", "ูุงูุฉ ุงูุจุดุฑ"], a: 1, points: pointValue, answered: false, feedback_c: "ุฅุฌุงุจุฉ ุตุญูุญุฉ. ุงูุชุณุงูุญ ุฎูู ุงูุฑุณู ูุงูุฃูู ูุชุญููู ูุฏููู ุจุงูุฏุนูุฉ ููุฎูุฑ.", feedback_i: "ุฅุฌุงุจุฉ ุฎุงุทุฆุฉ. ุงูุชุณุงูุญ ูู ุฎูู ุงูุฃูุจูุงุก ูุงูุฑุณู ูุฃูู ููุชุญ ููู ุฃุจูุงุจ ุงูุฏุนูุฉ ุฅูู ุงูุฎูุฑ." },
            { id: 'mc4', q: "ููู ุฃูุณ ุจู ูุงูู: 'ูุง ูุงู ูู : ุฃููู ูุท' ูุฏู ุนูู:", options: ["ุนูู ุงููุจู ุตูู ุงููู ุนููู ูุณูู", "ุณูุงุญุฉ ุงููุจู (๏ทบ) ูุนููู", "ุงูุดุบุงู ุงููุจู (๏ทบ) ุนูู", "ูุฑู ุงููุจู ุตูู ุงููู ุนููู ูุณูู"], a: 1, points: pointValue, answered: false, feedback_c: "ุฅุฌุงุจุฉ ุตุญูุญุฉ. ูุฐุง ุงูุญุฏูุซ ููุถุญ ูุฏู ุณูุงุญุฉ ุงููุจู ููููู ุญุชู ูุน ูู ูุฎุฏูู.", feedback_i: "ุฅุฌุงุจุฉ ุฎุงุทุฆุฉ. ูุฐุง ุงูุญุฏูุซ ูู ุฃุจูุบ ูุง ููู ูู ูุตู ุณูุงุญุฉ ุงููุจู (๏ทบ) ูุนููู ููููู ูู ุงูุชุนุงูู." },
            { id: 'mc5', q: "ุงูุชุณุงูุญ ูู ุงูุชุนุงูู ุงูุงุฌุชูุงุนู ูุน ุงููุณูููู ูุนูู:", options: ["ููุงุทุนุฉ ูู ุฃุณุงุก ุฅููู", "ุงูุนูู ุนูู ุฃุณุงุก ูุตูุฉ ูู ูุทุน", "ููุน ุงูุฅุญุณุงู ุนู ุงูุฌููุน", "ุงูุชุฑููุฒ ุนูู ุงูุฃุฎุทุงุก"], a: 1, points: pointValue, answered: false, feedback_c: "ุฅุฌุงุจุฉ ุตุญูุญุฉ. ุงูุชุณุงูุญ ูู ุงููุนุงููุงุช ูุดูู ุงูุนูู ูุตูุฉ ุงููุงุทุน.", feedback_i: "ุฅุฌุงุจุฉ ุฎุงุทุฆุฉ. ุงูุชุณุงูุญ ูุนูู ุงูุนูู ุนู ุงููุณูุก ูุตูุฉ ุงููุงุทุน ูุฅุนุทุงุก ูู ููุน." },
            { id: 'mc6', q: "ุงูุฐู ูุฌุนู ุญูุงุฉ ุงููุจู (๏ทบ) ูุชุดุฑูุนุงุชู ูุงุฆูุฉ ุนูู ุงููุณุฑ ูุงูุณูุงุญุฉ ูู:", options: ["ุงูุบุถุจ", "ุงููุฑู", "ุงูุชุฎููู ุนูู ุฃูุชู", "ุงูุงูุชูุงู"], a: 2, points: pointValue, answered: false, feedback_c: "ุฅุฌุงุจุฉ ุตุญูุญุฉ. ุงูุณูุงุญุฉ ูู ุงูุชุฎููู ุนูู ุงูุฃูุฉ ูุงูุงุจุชุนุงุฏ ุนู ุงูุดุฏุฉ.", feedback_i: "ุฅุฌุงุจุฉ ุฎุงุทุฆุฉ. ูู ุญูุงุฉ ุงููุจู (๏ทบ) ูุงูุช ูุงุฆูุฉ ุนูู ุงูุชุฎููู ุนูู ุฃูุชู ูุงูุชูุณูุฑ ุนูููุง." },
            { id: 'mc7', q: "ุงูุชุณุงูุญ ูุชุถูู ุฎูู ุงูุนุฏู ู ุงูุฅุญุณุงูุ ููุฐูู ุงูุนูู ูุงูุตูุญ ุนู ุงููุณูุฆูู ุจุฎุงุตุฉ ุนูุฏ:", options: ["ุงูุฎูู ูููู", "ุงููุฏุฑุฉ ุนูู ุงูุฑุฏ", "ุงูุถุนู ูุนุฏู ุงูุญููุฉ", "ุงูุดุบุงูู ุนููู"], a: 1, points: pointValue, answered: false, feedback_c: "ุฅุฌุงุจุฉ ุตุญูุญุฉ. ุงูุนูู ุนูุฏ ุงููุฏุฑุฉ ุนูู ุงูุฑุฏ ูู ููุฉ ุงูุชุณุงูุญ ูุงูุฃุฎูุงู.", feedback_i: "ุฅุฌุงุจุฉ ุฎุงุทุฆุฉ. ุงูุชุณุงูุญ ุงูุญูููู ูุธูุฑ ุนูุฏ ุงููุฏุฑุฉ ุนูู ุงูุฑุฏ ูููู ุชุฎุชุงุฑ ุงูุนูู." },
            { id: 'mc8', q: "ุฑุณุงูุฉ ุงููุจู (๏ทบ) ุณูุญุฉ ุฃู:", options: ["ุตุนุจุฉ ููุฌูุฏุฉ", "ุณููุฉ ููุณูุฑุฉ", "ูุชูุทุนุฉ ูููููุฉ", "ููุท ูุฃูู ููุฉ"], a: 1, points: pointValue, answered: false, feedback_c: "ุฅุฌุงุจุฉ ุตุญูุญุฉ. ุงูุณูุงุญุฉ ูุฑุงุฏูุฉ ูููุณุฑ ูุงูุณูููุฉ.", feedback_i: "ุฅุฌุงุจุฉ ุฎุงุทุฆุฉ. ูุนูู 'ุณูุญุฉ' ูู ุณููุฉ ููุณูุฑุฉ." },
            { id: 'mc9', q: "ุงูุฐูู ูููููู ูู ุงูุณููุฑููุงุกู ููุงูุถููุฑููุงุกู ููุฃุชูู ุจุงูุชุณุงูุญ ูู:", options: ["ุงููุณูุฆูู", "ุงูุฃูุจูุงุก ููุท", "ุงููุชููููู", "ุงููุญุณููู"], a: 3, points: pointValue, answered: false, feedback_c: "ุฅุฌุงุจุฉ ุตุญูุญุฉ. ุงูุขูุฉ ุชุฑุจุท ุงูุชุณุงูุญ ุจุงูุฅุญุณุงูุ ูุงููู ูุญุจ ุงููุญุณููู.", feedback_i: "ุฅุฌุงุจุฉ ุฎุงุทุฆุฉ. ุงูุขูุฉ ุงููุฑููุฉ ุฐูุฑุช ุฃู ุงููู ูุญุจ ุงููุญุณูููุ ููู ุงูุฐูู ููุธููู ุงูุบูุธ ููุนููู ุนู ุงููุงุณ." },
            { id: 'mc10', q: "ุฎูู ุงูุณูุงู ูุนุฏ ุงูุดุนุงุฑ ุงูุฃูู ูู:", options: ["ุงูุฎุตููุฉ", "ุงูุฅุณูุงู ูุงููุณูููู", "ุงูุฌูู", "ุงูุชุดุฏุฏ"], a: 1, points: pointValue, answered: false, feedback_c: "ุฅุฌุงุจุฉ ุตุญูุญุฉ. ุงูุณูุงู ูู ุงูุดุนุงุฑ ุงูุฃูู ูุงูุฃูู ูุฏูููุง.", feedback_i: "ุฅุฌุงุจุฉ ุฎุงุทุฆุฉ. ุฎูู ุงูุณูุงู ูู ุงูุดุนุงุฑ ุงูุฃูู ููุฅุณูุงู ูุงููุณููููุ ูููุถูู ุชุญุช ุฎูู ุงูุชุณุงูุญ." }
        ],
        
        // --- Fill in the Blanks Questions (Stage 3) - 5 Q (1 pt each = 5) ---
        fib: [
            { id: 'fib1', q: "ุฎูู ุงูุชุณุงูุญ ููุถูู ุชุญุชู ุนุฏุฉ ุฃุฎูุงู ุฃุฎุฑูุ ููู ุฃูููุง: ุงูุฑุญูุฉุ ูุงูุฑุฃูุฉ ูุงูุนุทูุ ูุฎูู ______.", a: ["ุงูุณูุงู"], points: pointValue, checked: false, feedback_c: "ุตุญูุญ! ุงูุณูุงู ูู ุงูุดุนุงุฑ ุงูุฃูู ููุฅุณูุงู ููู ุฃุญุฏ ูุฑูุน ุงูุชุณุงูุญ.", feedback_i: "ุฎุทุฃ. ุงูุชุณุงูุญ ุฎูู ุดุงูู ูุถู ุงูุฑุญูุฉ ูุงูุฑุฃูุฉ ูุฎูู **ุงูุณูุงู**." },
            { id: 'fib2', q: "ุฑุณุงูุฉ ุงููุจู ุนููู ุงูุตูุงุฉ ูุงูุณูุงู ุฑุณุงูุฉ ุณูุญุฉ ุฃู : ุณููุฉ ______.", a: ["ูุณูุฑุฉ"], points: pointValue, checked: false, feedback_c: "ุตุญูุญ! ุงูุฑุณุงูุฉ ุงูุณูุญุฉ ูู ุงูุณููุฉ ุงููุณูุฑุฉ ุงููุงุฆูุฉ ุนูู ุงูุชุฎููู.", feedback_i: "ุฎุทุฃ. ุฑุณุงูุฉ ุงููุจู (๏ทบ) ุณูุญุฉ ุฃู ุณููุฉ **ูุณูุฑุฉ**." },
            { id: 'fib3', q: "ุงูุชุณุงูุญ ูุทููุจ ูู ุฌููุน ุงููุนุงููุงุช ุงูุนุงูุฉ ุจูู ุงููุงุณุ ููู ุงูุชุนุงูู ุงูุงุฌุชูุงุนู ูุน ุงููุณููููุ ุจู ______ ุนูู ุฃุณุงุก.", a: ["ุงูุนูู"], points: pointValue, checked: false, feedback_c: "ุตุญูุญ! ุงูุนูู ูู ุฃุณุงุณ ุงูุชุนุงูู ุงูุงุฌุชูุงุนู ุงููุชุณุงูุญ.", feedback_i: "ุฎุทุฃ. ุงูุชุณุงูุญ ุงูุงุฌุชูุงุนู ูููู ุจู **ุงูุนูู** ุนูู ุฃุณุงุกุ ูุตูุฉ ูู ูุทุน." },
            { id: 'fib4', q: "ุงูุนูู ูุงูุตูุญ ุนู ุงููุณูุฆูู ูุทููุจุงู ุจุฎุงุตุฉ ุนูุฏ ุงููุฏุฑุฉ ุนูู ______.", a: ["ุงูุฑุฏ"], points: pointValue, checked: false, feedback_c: "ุตุญูุญ! ุงูุนูู ุนูุฏ ุงููุฏุฑุฉ ุนูู ุงูุฑุฏ ูู ุฃุฑูู ูุณุชููุงุช ุงูุชุณุงูุญ.", feedback_i: "ุฎุทุฃ. ุงูููุฉ ุงูุญููููุฉ ุชุธูุฑ ุนูุฏ ุงููุฏุฑุฉ ุนูู **ุงูุฑุฏ** ูุชุฎุชุงุฑ ุงูุนูู." },
            { id: 'fib5', q: "ุฎุฏู ุฃูุณ ุจู ูุงูู ุฑุณูู ุงููู ______ ุณููู.", a: ["ุนุดุฑ"], points: pointValue, checked: false, feedback_c: "ุตุญูุญ! ุฃูุณ ุจู ูุงูู ุฎุฏู ุงููุจู (๏ทบ) ุนุดุฑ ุณููู.", feedback_i: "ุฎุทุฃ. ุฎุงุฏู ุฑุณูู ุงููู ุฃูุณ ุจู ูุงูู ุฎุฏู ุงููุจู (๏ทบ) **ุนุดุฑ** ุณููู." }
        ]
    };
    
    // --- Helper Functions ---
    
    function shuffle(array) {
        let currentIndex = array.length, randomIndex;
        while (currentIndex != 0) {
            randomIndex = Math.floor(Math.random() * currentIndex);
            currentIndex--;
            [array[currentIndex], array[randomIndex]] = [array[randomIndex], array[currentIndex]];
        }
        return array;
    }

    function updateScore() {
        document.getElementById('current-score').innerText = score;
    }

    function getAchievementMessage(score, maxScore, gender) {
        const percentage = (score / maxScore) * 100;
        let message = "";
        
        // Custom gendered phrasing for the achievement message
        const isFemale = gender === 'ุทุงูุจุฉ';
        const title = isFemale ? 'ูุง ุจุทูุฉ ุงูุชุณุงูุญ' : 'ูุง ุจุทู ุงูุชุณุงูุญ';
        const pronoun = isFemale ? 'ุฃูุชู' : 'ุฃูุช';
        const noun = isFemale ? 'ูููุฐุฌ' : 'ูุฏูุฉ';

        if (percentage >= 90) {
            message = `ูุจุงุฑู ูู ${title}! ุฏุฑุฌุชู ููุชุงุฒุฉุ ${pronoun} ${noun} ูู ุชุทุจูู ุฎูู ุงูุชุณุงูุญ. ุงุณุชูุฑ ูู ูุดุฑ ุงููุญุจุฉ ูุงููุณุฑ.`;
        } else if (percentage >= 70) {
            message = `ุฃุฏุงุก ุฑุงุฆุน ${title}! ููุฏ ุฃุธูุฑุช ูููุงู ูููุงู ูุฃูููุฉ ุงูุนูู ูุงูุตูุญ. ${pronoun} ุนูู ุทุฑูู ุงูุฑุณู ูู ุงูุชุนุงูู ุจุฃุฎูุงู ุงูุฅุณูุงู ุงูุฑููุนุฉ.`;
        } else if (percentage >= 50) {
            message = `ุฃุฏุงุก ุฌูุฏ ${title}. ูุฏูู ุฃุณุงุณ ููุชุงุฒุ ููููู ุจุญุงุฌุฉ ููุฑุงุฌุนุฉ ุงููุต ูุฑุฉ ุฃุฎุฑู ูููุตูู ูุฃูุถู ุงูุฏุฑุฌุงุช. ุงูุชุณุงูุญ ูุจุฏุฃ ุจูุฑุงุฑ ูููู!`;
        } else {
            message = `ุจุฏุงูุฉ ููููุฉ ${title}. ุฎูู ุงูุชุณุงูุญ ูุญุชุงุฌ ุฅูู ุชุฏุฑูุจ ูููู. ุฑุงุฌุน ูุต ุงูุงุฎุชุจุงุฑ ูุชููู ุงููุนุงูู ุงูุนูููุฉ ููุฑุญูุฉ ูุงูุนูู. ููุชุธุฑ ููู ุฏุฑุฌุฉ ุฃุนูู ูู ุงููุญุงููุฉ ุงููุงุฏูุฉ.`;
        }
        return message;
    }

    function generateCertificateContent(score, maxScore, name, className, gender) {
        const title = (gender === 'ุทุงูุจุฉ') ? 'ุดูุงุฏุฉ ุชูุฏูุฑ ูุจุทูุฉ ุงูุชุณุงูุญ' : 'ุดูุงุฏุฉ ุชูุฏูุฑ ูุจุทู ุงูุชุณุงูุญ';
        const message = getAchievementMessage(score, maxScore, gender).replace(/ูุง ุจุทูุฉ ุงูุชุณุงูุญ|ูุง ุจุทู ุงูุชุณุงูุญ/g, ''); // Remove general title
        const achievementText = (score === maxScore) ? 'ุจู **ุงูุฏุฑุฌุฉ ุงููุงููุฉ**' : `ุจุฏุฑุฌุฉ ุงูุชูุงุฒ ูุฏุฑูุง`;
        
        return `
            <div id="print-area" style="font-family: 'Tajawal', sans-serif; padding: 50px; border: 10px solid #00796b; background-color: #f0f8ff; margin: 20px; border-radius: 20px; box-shadow: 0 0 20px rgba(0,0,0,0.2);">
                <h1 class="certificate-title">${title}</h1>
                <div class="certificate-text">
                    <p style="font-size: 20pt; margin-bottom: 30px; color: #37474f;">
                        ุชูููุญ ูุฐู ุงูุดูุงุฏุฉ ููุทุงูุจ/ูุฉ ุงููุชููุฒ/ุฉ:
                    </p>
                    <p>ุงูุงุณู: <span class="certificate-highlight">${name}</span></p>
                    <p>ุงูุตู/ุงููุตู: <span class="certificate-highlight">${className}</span></p>
                    <p style="margin-top: 30px; font-weight: 900; color: #4CAF50;">
                        ููุฏ ุญุตูุช ุนูู
                        <span class="score-highlight-print">${score}</span> ูู <span style="font-size: 28pt; color: #CC0000; font-weight: 900;">${maxScore}</span> ููุทุฉ.
                    </p>
                    <p style="margin-top: 40px; color: #1565c0; font-style: italic; font-weight: 700; font-size: 18pt;">
                        " ${message} "
                    </p>
                </div>
            </div>
        `;
    }

    function printCertificate() {
        const certificateHtml = generateCertificateContent(score, maxScore, studentName, studentClass, studentGender);
        
        const printWindow = window.open('', '', 'height=800,width=800');
        
        // Write content to the new window
        printWindow.document.write('<html><head><title>ุดูุงุฏุฉ ุงูุชุณุงูุญ</title>');
        printWindow.document.write('<style>');
        printWindow.document.write('@import url("https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap");');
        printWindow.document.write('body { font-family: "Tajawal", sans-serif; direction: rtl; padding: 0; margin: 0; }');
        printWindow.document.write('.certificate-title { font-size: 30pt; color: #00796b; border-bottom: 4px solid #4db6ac; padding-bottom: 15px; margin-bottom: 30px; text-align: center; font-weight: 900; }');
        printWindow.document.write('.certificate-text { font-size: 18pt; margin-bottom: 20pt; line-height: 2; text-align: center; font-weight: 700; }');
        printWindow.document.write('.certificate-highlight { font-size: 24pt; color: #1565c0; font-weight: 900; margin: 0 10px; display: inline-block; }'); // Name/Class highlight
        printWindow.document.write('.score-highlight-print { font-size: 28pt; color: #4CAF50; font-weight: 900; margin: 0 10px; }'); // Score highlight
        printWindow.document.write('</style></head><body>');
        printWindow.document.write(certificateHtml);
        printWindow.document.write('</body></html>');
        printWindow.document.close();
        
        // Wait for the styles/fonts to load before printing
        printWindow.onload = function() {
            printWindow.print();
        };
    }
    
    // Renders the persistent reading text (to be called in each stage)
    function renderReadingText() {
        // Updated Audio Link: https://drive.google.com/file/d/1aq6uFc02Psf6475t9KgJn8lT_QZzK2Wo/view?usp=sharing
        const audioLink = "https://drive.google.com/file/d/1aq6uFc02Psf6475t9KgJn8lT_QZzK2Wo/view?usp=sharing";

        return `
            <div class="text-section reading-text-placeholder" style="margin-bottom: 20px;">
                <a href="${audioLink}" target="_blank" class="audio-icon" title="ุงุณุชูุน ูููุต ุงููุฑุงุฆู">๐</a>
                <span class="read-instruction">ุงููุต ุงููุฑุงุฆู ( ุงูุชุณุงูุญ ):</span>
                <p><b>ุงูุชุณุงูุญ:</b> ุฎูู ุดุงูู ููุถูู ุชุญุชู ุนุฏุฉ ุฃุฎูุงู ุฃุฎุฑู ุ ููู ุฃูููุง: ุงูุฑุญูุฉุ ูุงูุฑุฃูุฉ ูุงูุนุทูุ ูุฎูู ุงูุณูุงู ุงูุฐู ูุนุฏ ุงูุดุนุงุฑ ุงูุฃูู ููุฅุณูุงู ูุงููุณูููู ุ ูุงูุนุฏู ูุงูุฅุญุณุงู ุ ูุงูุนูู ูุงูุตูุญ ุนู ุงููุณูุฆูู ุ ูุจุฎุงุตุฉ ุนูุฏ ุงููุฏุฑุฉ ุนูู ุงูุฑุฏ ุ ูุงูุงุนุชุฏุงู ูุนุฏู ุงูุชุดุฏุฏ ุ ููุจุฐ ุงูุชุนุตุจ ูู ุตูุฑู ุงูุฌุงูููุฉ ูููุง .</p>
                <p>ููุฏ ุฑุจุท ุงููุจู ุนููู ุงูุตูุงุฉ ูุงูุณูุงู ุจูู ุงูุณูุงุญุฉ ูุจูู ุฃุตู ุงูุฏูู ุงูุฅุณูุงููุ ุฅุฐ ุฌุนููุง ูู ุงูุนุฏูุฏ ูู ุฃุญุงุฏูุซู ูุตูุง ููุงุฒูุงุ ููุง ูู ูููู: ยซุจุนุซุช ุจุงูุญููููุฉ ุงูุณูุญุฉยปุ ูุฑุณุงูุฉ ุงููุจู ุนููู ุงูุตูุงุฉ ูุงูุณูุงู ุฑุณุงูุฉ ุญููููุฉ ุฃู : ูุงุฆูุฉ ุนู ุงูุจุงุทู ุฅูู ุงูุญู ุ ูุฑุณุงูุฉ ุณูุญุฉ ุฃู : ุณููุฉ ูุณูุฑุฉ; ููู ุญูุงุชู ูุชุดุฑูุนุงุชู ูุฅุฑุดุงุฏุงุชู ูุงุฆูุฉ ุนูู ุงููุณุฑ ูุงูุณูุงุญุฉ ูุงูุชุฎููู ุนูู ุฃูุชู .</p>
                <p>ูุงู ุงููู ุชุนุงูู: ๏ดฟ ููุจูููุง ุฑูุญูููุฉู ูููู ุงูููููู ููููุชู ูููููู ูููููู ููููุชู ููุธููุง ุบููููุธู ุงููููููุจู ููุงููููุถูููุง ูููู ุญููููููู ููุงุนููู ุนููููููู ููุงุณูุชูุบูููุฑู ูููููู ููุดูุงููุฑููููู ููู ุงููุฃูููุฑู ููุฅูุฐูุง ุนูุฒูููุชู ููุชูููููููู ุนูููู ุงูููููู ุฅูููู ุงูููููู ููุญูุจูู ุงููููุชููููููููููู ๏ดพ</p>
                <p>ููุงู ุชุนุงูู : ๏ดฟ ุงูููุฐูููู ููููููููููู ููู ุงูุณููุฑููุงุกู ููุงูุถููุฑููุงุกู ููุงููููุงุธูููููู ุงููุบูููุธู ููุงููุนูุงููููู ุนููู ุงููููุงุณู ููุงูููููู ููุญูุจูู ุงููููุญูุณูููููู ๏ดพ.</p>
                <p>ูุงูุชุณุงูุญ ูุทููุจ ูู ุฌููุน ุงููุนุงููุงุช ุงูุนุงูุฉ ุจูู ุงููุงุณ ุ ููู ุงูุชุนุงูู ุงูุงุฌุชูุงุนู ูุน ุงููุณูููู ุ ุจุงูุนูู ุนูู ุฃุณุงุก ุ ูุตูุฉ ูู ูุทุน ุ ูุฅุนุทุงุก ูู ููุน .</p>
                <p>ุงูุชุณุงูุญ ุฎูู ุงูุฑุณู ูุงูุฃูุจูุงุก ุนูููู ุงูุตูุงุฉ ูุงูุณูุงู ุ ูุงููุตูุญูู ูู ุงูุฃูู ุนูู ูุฑ ุงูุชุงุฑูุฎ ุ ูุฃู ุงูุชุณุงูุญ ุจูุงุจุฉ ูุชุญููู ูุง ุฃุฑุณููุง ุจู ููุง ูุฏุนูู ุฅููู ุ ูุงููุจู ุนููู ุงูุตูุงุฉ ูุงูุณูุงู ูู ุฃูุจู ุงูุจุดุฑ ูุฃูุถููู ุฃุฎูุงูุง ุ ููู ููู ูุชุญ ููุฉ ูุงู ูุฃูู ููุฉ ุงูุฐูู ุขุฐูู ูุญุงุฑุจูู ูุฃุฎุฑุฌูู ูู ุฏุงุฑู : ( ุงุฐูุจูุง ูุฃูุชู ุงูุทููุงุก ) .</p>
                <p>ูุง ูู ุฃูุณ ุจู ูุงูู - ุฑุถู ุงููู ุนูู ุฎุงุฏู ุฑุณูู ุงููู ูุฎุจุฑูุง ุนู ุฎูู ุงููุจู ุนููู ุงูุตูุงุฉ ูุงูุณูุงู ูุณูุงุญุชู ูุน ูู ูุฎุฏูู ุ ูููุถู ุญูุงุฆุฌู ุ ููููู: ( ุฎุฏูุช ุงูุฑุณูู ุนุดุฑ ุณููู ุ ูุงููู ูุง ูุงู ูู : ุฃููู ูุท ุ ููุง ูุงู ูู ูุดูุก : ูู ูุนูุช ูุฐุง ุ ูููููุง ูุนูุช ูุฐุง ) ุฑูุงู ูุณูู.</p>
            </div>
        `;
    }

    // --- Stage Rendering Functions ---

    function renderTF() {
        const container = document.getElementById('stage-1');
        
        // 1. Render Reading Text first
        container.innerHTML = renderReadingText();
        
        // 2. Render Scoreboard
        container.innerHTML += `
            <div class="score-board" style="display: flex;">
                <div style="color: var(--score-label-color);">ุงูููุงุท ุงูุญุงููุฉ: <span id="current-score-stage1" style="color: var(--score-value-color);">${score}</span> ๐</div>
                <div style="color: var(--score-label-color);">ุงูุฏุฑุฌุฉ ุงูููุงุฆูุฉ: <span style="color: var(--score-value-color);">25</span> ููุทุฉ.</div>
            </div>
            <h2>ุงููุฑุญูุฉ ุงูุฃููู: ุฃุณุงุณูุงุช ุงูุชุณุงูุญ (10 ุฃุณุฆูุฉ ุตุญ ูุฎุทุฃ - 1 ููุทุฉ ููุณุคุงู)</h2>
            <div id="tf-questions"></div>
            <button class="stage-btn" id="next-stage-1" onclick="checkAllAnswered(1, 10)">ุงูุชูู ูููุฑุญูุฉ ุงูุชุงููุฉ โก๏ธ</button>
        `;
        
        const qContainer = document.getElementById('tf-questions');
        shuffle(questions.tf).forEach((q, index) => {
            const qDiv = document.createElement('div');
            qDiv.className = 'question';
            qDiv.id = `q-${q.id}`;
            qDiv.innerHTML = `<p>${index + 1}. ${q.q}</p>
                <button class="option-btn" data-q="${q.id}" data-a="true" onclick="selectTF(this, '${q.id}', 1)">ุตุญ</button>
                <button class="option-btn" data-q="${q.id}" data-a="false" onclick="selectTF(this, '${q.id}', 1)">ุฎุทุฃ</button>
                <div id="feedback-${q.id}" class="feedback"></div>`;
            qContainer.appendChild(qDiv);
        });
        document.getElementById('current-score').innerText = score; // Update main score
    }

    function renderMC() {
        const container = document.getElementById('stage-2');
        container.innerHTML = renderReadingText() + `
            <div class="score-board" style="display: flex;">
                <div style="color: var(--score-label-color);">ุงูููุงุท ุงูุญุงููุฉ: <span id="current-score-stage2" style="color: var(--score-value-color);">${score}</span> ๐</div>
                <div style="color: var(--score-label-color);">ุงูุฏุฑุฌุฉ ุงูููุงุฆูุฉ: <span style="color: var(--score-value-color);">25</span> ููุทุฉ.</div>
            </div>
            <h2>ุงููุฑุญูุฉ ุงูุซุงููุฉ: ููุงููู ุงูุชุณุงูุญ (10 ุฃุณุฆูุฉ ุงุฎุชูุงุฑ ูู ูุชุนุฏุฏ - 1 ููุทุฉ ููุณุคุงู)</h2>
            <div id="mc-questions"></div>
            <button class="stage-btn" id="next-stage-2" onclick="checkAllAnswered(2, 10)">ุงูุชูู ูููุฑุญูุฉ ุงูุฃุฎูุฑุฉ โก๏ธ</button>
        `;
        
        const qContainer = document.getElementById('mc-questions');
        shuffle(questions.mc).forEach((q, index) => {
            const qDiv = document.createElement('div');
            qDiv.className = 'question';
            qDiv.id = `q-${q.id}`;
            qDiv.innerHTML = `<p>${index + 1}. ${q.q}</p>`;
            
            q.options.forEach((option, oIndex) => {
                const isCorrect = oIndex === q.a;
                qDiv.innerHTML += `<button class="option-btn" data-q="${q.id}" data-o="${oIndex}" data-correct="${isCorrect}" onclick="selectMC(this, '${q.id}', ${isCorrect}, 2)">${option}</button>`;
            });
            qDiv.innerHTML += `<div id="feedback-${q.id}" class="feedback"></div>`;
            qContainer.appendChild(qDiv);
        });
        document.getElementById('current-score').innerText = score; // Update main score
    }

    function renderFIB() {
        const container = document.getElementById('stage-3');
        container.innerHTML = renderReadingText() + `
            <div class="score-board" style="display: flex;">
                <div style="color: var(--score-label-color);">ุงูููุงุท ุงูุญุงููุฉ: <span id="current-score-stage3" style="color: var(--score-value-color);">${score}</span> ๐</div>
                <div style="color: var(--score-label-color);">ุงูุฏุฑุฌุฉ ุงูููุงุฆูุฉ: <span style="color: var(--score-value-color);">25</span> ููุทุฉ.</div>
            </div>
            <h2>ุงููุฑุญูุฉ ุงูุซุงูุซุฉ: ุจูุงุก ุงูุชุณุงูุญ (5 ุฃุณุฆูุฉ ุฃููู ุงููุฑุงุบ - 1 ููุทุฉ ููุณุคุงู)
                <span class="stage-3-note"><span class="red-text">ุชูุจูู: ูุฌุจ ุงู ุชููู ุงูุฅุฌุงุจุฉ ูู ุงููุต ูุชุฃูุฏ ูู ุณูุงูุชูุง ูู ุงูุฃุฎุทุงุก ุงูุฅููุงุฆูุฉ</span></span>
            </h2>
            <div id="fib-questions"></div>
            <button class="stage-btn" id="next-stage-3" onclick="checkAllAnswered(3, 5)">ุนุฑุถ ุงููุชูุฌุฉ ุงูููุงุฆูุฉ ๐</button>
        `;
        
        const qContainer = document.getElementById('fib-questions');
        shuffle(questions.fib).forEach((q, index) => {
            const qDiv = document.createElement('div');
            qDiv.className = 'question fill-in';
            qDiv.id = `q-${q.id}`;
            
            const initialInput = document.createElement('input');
            initialInput.type = 'text';
            initialInput.id = `fib-input-${q.id}`;
            initialInput.placeholder = 'ุงูุชุจ ุงูุฅุฌุงุจุฉ ููุง';
            initialInput.required = true;
            
            const checkButton = document.createElement('button');
            checkButton.className = 'check-btn';
            checkButton.innerText = 'ุชุญูู ูู ุงูุฅุฌุงุจุฉ';
            checkButton.disabled = true; // Initially disabled
            checkButton.style.opacity = '0.6';

            // Event listener to enable check button on input change
            initialInput.oninput = function() {
                const button = this.closest('.question').querySelector('.check-btn');
                if (button) {
                    // Enable if there is text, disable if empty
                    const hasText = this.value.trim() !== '';
                    button.disabled = !hasText;
                    button.style.opacity = hasText ? '1' : '0.6';
                }
            };
            checkButton.onclick = () => checkFIB(q.id, 3);
            
            const feedbackDiv = document.createElement('div');
            feedbackDiv.id = `feedback-${q.id}`;
            feedbackDiv.className = 'feedback';
            
            // Build the question paragraph, using outerHTML for the input element
            qDiv.innerHTML = `<p>${index + 1}. ${q.q.replace('______', initialInput.outerHTML)}</p>`;
            
            // Re-select the dynamically created input element and attach the event handler again
            qDiv.querySelector('input').oninput = initialInput.oninput;
            
            qDiv.appendChild(checkButton);
            qDiv.appendChild(feedbackDiv);
            
            qContainer.appendChild(qDiv);
        });
        document.getElementById('current-score').innerText = score; // Update main score
    }

    // --- Interaction and Checking Functions ---

    function checkAllAnswered(stageIndex, totalQuestions) {
        let unansweredCount = 0;
        let questionData = [];
        
        if (stageIndex === 1) {
            questionData = questions.tf;
        } else if (stageIndex === 2) {
            questionData = questions.mc;
        } else if (stageIndex === 3) {
            questionData = questions.fib;
            
            // --- STEP 1: FORCE GRADING OF ALL UNCHECKED FIB INPUTS ---
            questionData.forEach(q => {
                const input = document.getElementById(`fib-input-${q.id}`);
                // Check if input exists and hasn't been checked
                if (input && !q.checked) {
                    // Check if input has text before forcing a check, to count truly unanswered
                    if (input.value.trim() !== '') {
                        checkFIB(q.id, 3); 
                    } else {
                        unansweredCount++;
                    }
                }
            });
        }

        questionData.forEach(q => {
            const isAnswered = (stageIndex === 3) ? q.checked : q.answered;
            
            if (!isAnswered) {
                unansweredCount++;
            }
        });

        if (unansweredCount === 0) {
            nextStage(stageIndex + 1);
        } else {
            alert(`ุงูุฑุฌุงุก ุงูุฅุฌุงุจุฉ ุนูู ุฌููุน ุงูุฃุณุฆูุฉ! ูุฏูู ${unansweredCount} ุณุคุงู ูู ูุชู ุญูู.`);
        }
    }
    
    function selectTF(button, qId, stageIndex) {
        const qData = questions.tf.find(q => q.id === qId);
        if (!qData || qData.answered) return;
        
        const selectedAnswer = button.dataset.a === 'true';
        const correct = qData.a;
        const feedbackDiv = document.getElementById(`feedback-${qId}`);
        
        const qDiv = button.closest('.question');
        qDiv.querySelectorAll('.option-btn').forEach(btn => {
            btn.disabled = true;
        });
        
        if (selectedAnswer === correct) {
            button.classList.add('correct');
            score += qData.points;
            feedbackDiv.style.backgroundColor = '#e8f5e9';
            feedbackDiv.style.color = '#388E3C';
            feedbackDiv.innerHTML = `โ ${qData.feedback_c}`;
        } else {
            button.classList.add('incorrect');
            qDiv.querySelector(`[data-a="${correct}"]`).classList.add('correct');
            feedbackDiv.style.backgroundColor = '#ffebee';
            feedbackDiv.style.color = '#D32F2F';
            feedbackDiv.innerHTML = `โ ${qData.feedback_i}`;
        }
        qData.answered = true;
        updateScore();
        if (stageIndex === 1) document.getElementById('current-score-stage1').innerText = score;
    }

    function selectMC(button, qId, stageIndex) {
        const qData = questions.mc.find(q => q.id === qId);
        if (!qData || qData.answered) return;

        const isCorrect = button.dataset.correct === 'true';
        const feedbackDiv = document.getElementById(`feedback-${qId}`);
        
        const qDiv = button.closest('.question');
        qDiv.querySelectorAll('.option-btn').forEach(btn => {
            btn.disabled = true;
        });

        if (isCorrect) {
            button.classList.add('correct');
            score += qData.points;
            feedbackDiv.style.backgroundColor = '#e8f5e9';
            feedbackDiv.style.color = '#388E3C';
            feedbackDiv.innerHTML = `โ ${qData.feedback_c || 'ุฅุฌุงุจุฉ ุตุญูุญุฉ! ุฃุญุณูุช.'}`;
        } else {
            button.classList.add('incorrect');
            // Highlight correct answer
            qDiv.querySelector(`[data-correct="true"]`).classList.add('correct');
            feedbackDiv.style.backgroundColor = '#ffebee';
            feedbackDiv.style.color = '#D32F2F';
            feedbackDiv.innerHTML = `โ ${qData.feedback_i || 'ุฅุฌุงุจุฉ ุฎุงุทุฆุฉ. ุฑุงุฌุน ุงููุต.'}`;
        }
        qData.answered = true;
        updateScore();
        if (stageIndex === 2) document.getElementById('current-score-stage2').innerText = score;
    }

    function checkFIB(qId, stageIndex) {
        const qData = questions.fib.find(q => q.id === qId);
        if (!qData || qData.checked) return;
        
        const input = document.getElementById(`fib-input-${qId}`);
        const userAnswer = input.value.trim().toLowerCase();
        const feedbackDiv = document.getElementById(`feedback-${qId}`);
        const checkBtn = input.closest('.fill-in').querySelector('.check-btn');

        const isCorrect = qData.a.some(correctAnswer => userAnswer === correctAnswer.toLowerCase());
        
        if (isCorrect) {
            score += qData.points;
            input.style.backgroundColor = '#81c784';
            input.style.color = 'white';
            feedbackDiv.style.backgroundColor = '#e8f5e9';
            feedbackDiv.style.color = '#388E3C';
            feedbackDiv.innerHTML = `โ ${qData.feedback_c}`;
        } else {
            input.style.backgroundColor = '#e57373';
            input.style.color = 'white';
            feedbackDiv.style.backgroundColor = '#ffebee';
            feedbackDiv.style.color = '#D32F2F';
            feedbackDiv.innerHTML = `โ ${qData.feedback_i}. (ุงูุฅุฌุงุจุฉ ุงูุตุญูุญุฉ ูู: ${qData.a[0]})`;
        }
        
        qData.checked = true;
        qData.answered = true; // Mark as answered
        input.disabled = true;
        if(checkBtn) {
            checkBtn.disabled = true;
            checkBtn.style.opacity = '0.5';
        }
        updateScore();
        if (stageIndex === 3) document.getElementById('current-score-stage3').innerText = score;
    }
    
    // Function to handle moving from first page to intro page (now the only button)
    function checkInputsAndGoToIntro() {
        studentName = document.getElementById('student-name').value.trim();
        studentClass = document.getElementById('student-class').value.trim();
        const selectedGender = document.querySelector('input[name="gender"]:checked');
        studentGender = selectedGender ? selectedGender.value : '';

        if (studentName && studentClass && studentGender) {
            
            // Apply theme based on gender before showing next screens
            applyTheme(studentGender);

            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('intro-page-content').style.display = 'block';
            
            // Set initial scores display
            document.getElementById('max-score-display').innerText = maxScore;
            document.getElementById('final-max-score').innerText = maxScore;

            // Hide the actual quiz stages until the main start button is clicked
            document.getElementById('stage-1').style.display = 'none';
            document.getElementById('stage-2').style.display = 'none';
            document.getElementById('stage-3').style.display = 'none';
            document.getElementById('results').style.display = 'none';
            
            // Ensure score-board is NOT displayed on the intro page (Page 2)
            document.getElementById('score-board-main').style.display = 'none'; 

        } else {
            alert('ุงูุฑุฌุงุก ุชุนุจุฆุฉ ุฌููุน ุงูุญููู ูุจู ุงูุจุฏุก ุจุงูุงุฎุชุจุงุฑ.');
        }
    }

    // Custom function to handle starting the quiz after reading the text (Page 2)
    function startQuiz() {
         document.getElementById('intro-page-content').style.display = 'none'; // Hide the Page 2 content
         
         document.getElementById('score-board-main').style.display = 'flex'; // Show score board for quiz stages
         document.querySelector('.quiz-section').style.display = 'block'; // Ensure quiz section is visible
         nextStage(1);
    }
    
    document.getElementById('start-quiz-btn').onclick = checkInputsAndGoToIntro;


    // --- Stage Progression Logic ---
    function nextStage(stageNumber) {
        // Hide all quiz stages
        document.getElementById('intro-page-content').style.display = 'none';
        document.getElementById('stage-1').style.display = 'none';
        document.getElementById('stage-2').style.display = 'none';
        document.getElementById('stage-3').style.display = 'none';
        document.getElementById('results').style.display = 'none';


        if (stageNumber === 1) {
            document.getElementById('stage-1').style.display = 'block';
            renderTF();
        } else if (stageNumber === 2) {
            document.getElementById('stage-2').style.display = 'block';
            renderMC();
        } else if (stageNumber === 3) {
            document.getElementById('stage-3').style.display = 'block';
            renderFIB();
        } else if (stageNumber === 4) {
            // Final Results Display
            document.getElementById('score-board-main').style.display = 'none'; 
            document.getElementById('results').style.display = 'block';
            
            document.getElementById('final-score').innerText = score;
            
            // Get message based on score
            const finalMessageHtml = getAchievementMessage(score, maxScore, studentGender);
            document.getElementById('final-message').innerHTML = finalMessageHtml;
            
            // Display student info
            document.getElementById('display-name').innerText = studentName;
            document.getElementById('display-class').innerText = studentClass;
            document.getElementById('display-gender').innerText = studentGender;
        }
    }
</script>

</body>
</html>